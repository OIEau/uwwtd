<?php
require_once 'uwwtd.stats.inc';

function uwwtd_stats_graphs_page(){

	$form = drupal_get_form('uwwtd_stats_graphs_form');

	return render($form);
}

function uwwtd_stats_graphs_form($form, &$form_state){

	$form['#prefix'] = '<h1 align="center">' . t('Graphs for national stats') . '</h1>';
	$form['description'] = array('#markup' => t('<p>Select the year to generate the graphs.</p>'));

	// Get available years for data
		$query = db_select('field_data_field_anneedata', 'a');
		$query->fields('a', array('field_anneedata_value'));
		$query->orderBy('field_anneedata_value', 'DESC');
		$results = $query->execute();
		$years = array('all' => 'Show all');
		while($record = $results->fetchAssoc()) {
			$years[$record['field_anneedata_value']] = $record['field_anneedata_value'];
		}
		$form['year'] = array(
				'#title' => t('Available years'),
				'#type' => 'select',
				'#options' => $years,
				'#default_value' => isset($form_state['values']['year']) ? $form_state['values']['year'] : 'all',
		);



		$form['submit'] = array(
				'#type' => 'submit',
				'#attributes' => array('class' => array('btn-primary', 'btn')),
				'#value' => t('Refresh graphs')
		);

		if(isset($form_state['storage']['result'])) {
			$form['#suffix'] .= $form_state['storage']['result'];
		}

	return $form;

}

/**
 * Form validation.
 */
function uwwtd_stats_graphs_form_validate(&$form, &$form_state) {


}



/**
 * Form submit.
 */
function uwwtd_stats_graphs_form_submit(&$form, &$form_state) {

	$form_state['rebuild'] = TRUE;

	$options = array(
			'year' => $form_state['values']['year'],
	);

	$table = uwwtd_page_stats_graphs_result($options);
	$form_state['storage']['result'] = $table;

}



function uwwtd_page_stats_graphs_result($options){
	drupal_add_js('sites/all/libraries/d3/d3.v3.min.js');
	drupal_add_js(drupal_get_path('module', 'uwwtd') . '/lib/flip/jquery.flip.min.js');
	drupal_add_js(drupal_get_path('module', 'uwwtd') . '/js/uwwtd.js');





	$formResult = "";
	/*
	 * LOADING DATA ...
	*/
	// Total generated by compliance
	$Data_uwwtd_stat_national_compliance = array();
	$String_uwwtd_stat_national_compliance = '';

	$results = uwwtd_stat_national_compliance($options);
	foreach ($results as $result){
		$Data_uwwtd_stat_national_compliance[] = array(
				"value" => $result['generated_sum'],
				"label" => $result['field_aggcompliance_value_format'] .' ['.$result['generated_sum'].' pe]',
				"valueformat" => $result['generated_sum_format'].' pe',
                "color"=>isset($result['color'])?$result['color']:null
		);
		$String_uwwtd_stat_national_compliance .= $result['field_aggcompliance_value_format'] . ' : ' . $result['generated_sum_format'] . ' pe<br/>';
	}
   
    
	// Total agglomerations by compliance
	$Data_uwwtd_stat_agglomeration_compliance = array();
	$String_uwwtd_stat_agglomeration_compliance = '';

	$results = uwwtd_stat_national_compliance($options);
	foreach ($results as $result){
		$Data_uwwtd_stat_agglomeration_compliance[] = array(
				"value" => $result['total_count'],
				"label" => $result['field_aggcompliance_value_format'] .' ['.$result['total_count'].']',
				"valueformat" => $result['total_count_format'],
                "color"=>isset($result['color'])?$result['color']:null
		);
		$String_uwwtd_stat_agglomeration_compliance .= $result['field_aggcompliance_value_format'] . ' : ' . $result['total_count_format'] . '<br/>';
	}

	//Total load entering by compliance

	$aData_uwwtd_stat_national_uwwtpC = array();
	$aString_uwwtd_stat_national_uwwtpC = '';

	$results = uwwtd_stat_national_uwwtp($options,'compliance');
	foreach ($results as $result){
		$aData_uwwtd_stat_national_uwwtpC[] = array(
				"value" => $result['loadentering_sum'],
				"label" => $result['field_uwwcompliance_value_format'].' ['.$result['loadentering_sum'].' pe]',
				"valueformat" => $result['loadentering_sum_format'].' pe',
                "color"=>isset($result['color'])?$result['color']:null
		);
		$aString_uwwtd_stat_national_uwwtpC .= $result['field_uwwcompliance_value_format'] . ' : ' . $result['loadentering_sum_format'] . ' pe<br/>';
	}

	//Load entering by compliance : total agglomerations

	$aData_uwwtd_stat_agglomeration_uwwtpC = array();
	$aString_uwwtd_stat_agglomeration_uwwtpC = '';

	$results = uwwtd_stat_national_uwwtp($options,'compliance');
	foreach ($results as $result){
		$aData_uwwtd_stat_agglomeration_uwwtpC[] = array(
				"value" => $result['total_count'],
				"label" => $result['field_uwwcompliance_value_format'] .' ['.$result['total_count'].']',
				"valueformat" => $result['total_count_format'],
                "color"=>isset($result['color'])?$result['color']:null
		);
		$aString_uwwtd_stat_agglomeration_uwwtpC .= $result['field_uwwcompliance_value_format'] . ' : ' . $result['total_count_format'] . '<br/>';
	}

	//Total load entering by treatment type

	$aData_uwwtd_stat_national_uwwtpT = array();
	$aString_uwwtd_stat_national_uwwtpT = '';

	$results = uwwtd_stat_national_uwwtp($options,'treatmenttype');
	foreach ($results as $result){
		$aData_uwwtd_stat_national_uwwtpT[] = array(
				"value" => $result['loadentering_sum'],
				"label" => $result['field_uwwtreatmenttype_value_format'] .' ['.$result['loadentering_sum'].' pe]',
				"valueformat" => $result['loadentering_sum_format'],
                "color"=>isset($result['color'])?$result['color']:null
		);
		$aString_uwwtd_stat_national_uwwtpT .= $result['field_uwwtreatmenttype_value_format'] . ' : ' . $result['loadentering_sum_format'] . '<br/>';
	}

	//Load entering by treatment type : total agglomerations

	$aData_uwwtd_stat_agglomeration_uwwtpT = array();
	$aString_uwwtd_stat_agglomeration_uwwtpT = '';

	$results = uwwtd_stat_national_uwwtp($options,'treatmenttype');
	foreach ($results as $result){
		$aData_uwwtd_stat_agglomeration_uwwtpT[] = array(
				"value" => $result['total_count'],
				"label" => $result['field_uwwtreatmenttype_value_format'] .' ['.$result['total_count'].']',
				"valueformat" => $result['total_count_format'],
                "color"=>isset($result['color'])?$result['color']:null
		);
		$aString_uwwtd_stat_agglomeration_uwwtpT .= $result['field_uwwtreatmenttype_value_format'] . ' : ' . $result['total_count_format'] . '<br/>';
	}

	//Total generated load by agglomeration

	$aData_uwwtd_stat_national_generated_by_agglomeration = array();
	$aString_uwwtd_stat_national_generated_by_agglomeration = '';

	$results = uwwtd_stat_national_generated_by_agglomeration($options);
	foreach ($results as $result){

		$aData_uwwtd_stat_national_generated_by_agglomeration[] = array(
				"type" => $result['type'],
				"generated" => $result['generated_sum'],
		);
		$aString_uwwtd_stat_national_generated_by_agglomeration .= $result['type'] . ' : ' . $result['generated_sum'] . '<br/>';

	}

	//Total load entering and discharged

	$aData_uwwtd_load_ent_and_dis = array();
	$aString_uwwtd_load_ent_and_dis = '<table>';
    $aString_uwwtd_load_ent_and_dis.= '<tr><th>Parameter</th><th>Entering load (t/year)</th><th>Discharged load (t/year)</th></tr>';

	$results = uwwtd_stat_national_treatmentplant($options);
	foreach ($results as $result){

		$aData_uwwtd_load_ent_and_dis[] = array(
				"type" => "BOD",
				"entering" => $result['bodin_sum'],
				"discharged" => $result['bodout_sum']
		);
        $aString_uwwtd_load_ent_and_dis .= '<tr><td>BOD</td><td>' . $result['bodin_sum_format'] . '</td><td>'.$result['bodout_sum_format'] . '</td></tr>';
		
		$aData_uwwtd_load_ent_and_dis[] = array(
				"type" => "COD",
				"entering" => $result['codin_sum'],
				"discharged" => $result['codout_sum']
		);
		$aString_uwwtd_load_ent_and_dis .= '<tr><td>COD</td><td>' . $result['codin_sum_format'] . '</td><td>'.$result['codout_sum_format'] . '</td></tr>';
		
        $aData_uwwtd_load_ent_and_dis[] = array(
				"type" => "N",
				"entering" => $result['nin_sum'],
				"discharged" => $result['nout_sum']
		);
		$aString_uwwtd_load_ent_and_dis .= '<tr><td>N</td><td>' . $result['nin_sum_format'] . '</td><td>'.$result['nout_sum_format'] . '</td></tr>';
		$aData_uwwtd_load_ent_and_dis[] = array(
				"type" => "P",
				"entering" => $result['pin_sum'],
				"discharged" => $result['pout_sum']
		);
        $aString_uwwtd_load_ent_and_dis .= '<tr><td>P</td><td>' . $result['pin_sum_format'] . '</td><td>'.$result['pout_sum_format'] . '</td></tr>';
	}
    $aString_uwwtd_load_ent_and_dis.= '</table>';
	$aColor_uwwtd_load_ent_and_dis ['domain'] = array (
			'entering',
			'discharged'
	);
	$aColor_uwwtd_load_ent_and_dis ['range'] = array (
			'#74FFE0',
			'#C00000'
	);

	//BOD, COD, N, P concentration

	$aData_uwwtd_per_ent_and_dis = array();
	$aString_uwwtd_per_ent_and_dis = '<table>';
    $aString_uwwtd_per_ent_and_dis.= '<tr><th>Parameter</th><th>Entering (mg/l)</th><th>Discharged (mg/l)</th><th>Rate (%)</th></tr>';

	$results = uwwtd_stat_national_treatmentplant($options);
	foreach ($results as $result){

		$aData_uwwtd_per_ent_and_dis[] = array(
				"type" => "BOD",
				"incoming" => ($result['bodin_sum']/$result['uwwt_sum'])*1000,
				"discharged" => ($result['bodout_sum']/$result['uwwt_sum'])*1000
		);
		$aString_uwwtd_per_ent_and_dis .='<tr><td>BOD</td><td>' . $result['bodin_sum_format']/$result['uwwt_sum']*1000 . '</td><td>'. $result['bodout_sum_format']/$result['uwwt_sum']*1000 . '</td><td>'. round(((1- ($result['bodout_sum']/ $result['bodin_sum']))*100), 1) . ' %</td><td>';
		
        $aData_uwwtd_per_ent_and_dis[] = array(
				"type" => "COD",
				"incoming" => ($result['codin_sum']/$result['uwwt_sum'])*1000,
				"discharged" => ($result['codout_sum']/$result['uwwt_sum'])*1000
		);
        $aString_uwwtd_per_ent_and_dis .='<tr><td>COD</td><td>' . $result['codin_sum_format']/$result['uwwt_sum']*1000 . '</td><td>'. $result['codout_sum_format']/$result['uwwt_sum']*1000 . '</td><td>'. round(((1- ($result['codout_sum_format']/ $result['codin_sum_format']))*100), 1) . ' %</td><td>';
		$aData_uwwtd_per_ent_and_dis[] = array(
				"type" => "N",
				"incoming" => ($result['nin_sum']/$result['uwwt_sum'])*1000,
				"discharged" => ($result['nout_sum']/$result['uwwt_sum'])*1000
		);
        
        $aString_uwwtd_per_ent_and_dis .='<tr><td>COD</td><td>' . $result['nin_sum_format']/$result['uwwt_sum']*1000 . '</td><td>'. $result['nout_sum_format']/$result['uwwt_sum']*1000 . '</td><td>'. round(((1- ($result['nout_sum_format']/ $result['nin_sum_format']))*100), 1) . ' %</td><td>';
		$aData_uwwtd_per_ent_and_dis[] = array(
				"type" => "P",
				"incoming" => ($result['pin_sum']/$result['uwwt_sum'])*1000,
				"discharged" => ($result['pout_sum']/$result['uwwt_sum'])*1000
		);
        
        
		$aString_uwwtd_per_ent_and_dis .='<tr><td>P</td><td>' . $result['pin_sum_format']/$result['uwwt_sum']*1000 . '</td><td>'. $result['pout_sum_format']/$result['uwwt_sum']*1000 . '</td><td>'. round(((1- ($result['pout_sum_format']/ $result['pin_sum_format']))*100), 1) . ' %</td><td>';

	}
    $aString_uwwtd_per_ent_and_dis.= '</table>';
	$aColor_uwwtd_per_ent_and_dis ['domain'] = array (
			'incoming',
			'discharged'
	);
	$aColor_uwwtd_per_ent_and_dis ['range'] = array (
			'#74FFE0',
			'#C00000'
	);






	/*
	 * FLIPCARDS
	*/
	// Total generated by compliance
	// Total agglomerations by compliance
	$formResult = ''
			. '<h1 align="center">'.$title.'</h1>'
					//. $form
	//.'<div class="rows map-row" >'.$rendermap.'</div>'
	.'<div class="rows charts-row" >'
                .'<div class="cell charts-rows-cell">'
                  .'<div class="cell-content">'
                    .'<div class="container flip">'
                      .'<div class="leftgraph front">'
                        . '<div class="flot-title"><div class="flip-title">Total generated by compliance</div>


                        <img src="'.file_create_url(drupal_get_path('theme', 'uwwtd').'/images/corner-table-off.png').'" class="button-flipper to-table" title="See the data table" alt="See the data table">
                        </div>'
                        . '<div class="view-content"><svg id="graph_generatedByCompliance" style="margin:10px;"/></div>'
                      .'</div>'

                        		.'<div class="leftgraph back">'
                        . '<div class="flot-title flip-title-back"><div class="flip-title">Total generated by compliance</div>


                        <img src="'.file_create_url(drupal_get_path('theme', 'uwwtd').'/images/corner-chart-off.png').'" class="button-flipper to-chart" title="See diagram" alt="See diagram">
                        </div>'
                        . '<div class="view-content">'. $String_uwwtd_stat_national_compliance .'</div>'
                      .'</div>'
                    .'</div>'
                  .'</div>'
                .'</div>'
                .'<div class="cell charts-rows-cell">'
                  .'<div class="cell-content">'
                    .'<div class="container flip">'

                      .'<div class="rightgraph front">'
                            . '<div class="flot-title"><div class="flip-title">Total agglomerations by compliance</div>


                            <img src="'.file_create_url(drupal_get_path('theme', 'uwwtd').'/images/corner-table-off.png').'" class="button-flipper to-table" title="See the data table" alt="See the data table">
                            </div>'
                            . '<div class="view-content"><svg id="graph_agglomerationByCompliance" style="margin:10px;"/></div>'
                      .'</div>'

                      .'<div class="rightgraph back">'
                        . '<div class="flot-title flip-title-back"><div class="flip-title">Total agglomerations by compliance</div>


                        <img src="'.file_create_url(drupal_get_path('theme', 'uwwtd').'/images/corner-chart-off.png').'" class="button-flipper to-chart" title="See diagram" alt="See diagram">
                        </div>'
                        . '<div class="view-content">'. $String_uwwtd_stat_agglomeration_compliance .'</div>'
                      .'</div>'
                    .'</div>'
                  .'</div>'
                .'</div>'
            .'</div>'
     ;
            		//Total load entering by compliance
            		//Load entering by compliance : total agglomerations
            		$formResult .= '<div class="rows charts-row" >'
                .'<div class="cell charts-rows-cell">'
                  .'<div class="cell-content">'
                  .'<div class="container flip">'
                  		.'<div class="leftgraph front">'
                  				. '<div class="flot-title"><div class="flip-title">Total load entering by compliance</div>


                        <img src="'.file_create_url(drupal_get_path('theme', 'uwwtd').'/images/corner-table-off.png').'" class="button-flipper to-table" title="See the data table" alt="See the data table">
                        </div>'
                        		. '<div class="view-content"><svg id="graph_loadenteringByCompliance" style="margin:10px;"/></div>'
                        		.'</div>'

                        		.'<div class="leftgraph back">'
                        		. '<div class="flot-title flip-title-back"><div class="flip-title">Total load entering by compliance</div>


                        				<img src="'.file_create_url(drupal_get_path('theme', 'uwwtd').'/images/corner-chart-off.png').'" class="button-flipper to-chart" title="See diagram" alt="See diagram">
                        </div>'
                        						. '<div class="view-content">'. $aString_uwwtd_stat_national_uwwtpC .'</div>'
                      .'</div>'
                    .'</div>'
                    		.'</div>'
                    				.'</div>'
                .'<div class="cell charts-rows-cell">'
                  .'<div class="cell-content">'
                    .'<div class="container flip">'

                      .'<div class="rightgraph front">'
                            . '<div class="flot-title"><div class="flip-title">Load entering by compliance : total agglomerations</div>


                            <img src="'.file_create_url(drupal_get_path('theme', 'uwwtd').'/images/corner-table-off.png').'" class="button-flipper to-table" title="See the data table" alt="See the data table">
                            		</div>'
                            . '<div class="view-content"><svg id="graph_loadenteringByComplianceAgglomeration" style="margin:10px;"/></div>'
                            		.'</div>'

                      .'<div class="rightgraph back">'
                        . '<div class="flot-title flip-title-back"><div class="flip-title">Load entering by compliance : total agglomerations</div>


                        <img src="'.file_create_url(drupal_get_path('theme', 'uwwtd').'/images/corner-chart-off.png').'" class="button-flipper to-chart" title="See diagram" alt="See diagram">
                        		</div>'
                        				. '<div class="view-content">'. $aString_uwwtd_stat_agglomeration_uwwtpC .'</div>'
                      .'</div>'
                      		.'</div>'
                      				.'</div>'
                      				.'</div>'
                      				.'</div>'
                      				;

                      				//Total load entering by treatment type
     //Load entering by treatment type : total agglomerations
     $formResult .= '<div class="rows charts-row" >'
                .'<div class="cell charts-rows-cell">'
                  .'<div class="cell-content">'
                  .'<div class="container flip">'
                      .'<div class="leftgraph front">'
                        . '<div class="flot-title"><div class="flip-title">Total load entering by treatment type</div>


                        <img src="'.file_create_url(drupal_get_path('theme', 'uwwtd').'/images/corner-table-off.png').'" class="button-flipper to-table" title="See the data table" alt="See the data table">
                        </div>'
                        		. '<div class="view-content"><svg id="graph_loadenteringByTreatmenttype" style="margin:10px;"/></div>'
                      .'</div>'

                             		.'<div class="leftgraph back">'
                        . '<div class="flot-title flip-title-back"><div class="flip-title">Total load entering by treatment type</div>


                        <img src="'.file_create_url(drupal_get_path('theme', 'uwwtd').'/images/corner-chart-off.png').'" class="button-flipper to-chart" title="See diagram" alt="See diagram">
                        		</div>'
                        				. '<div class="view-content">'. $aString_uwwtd_stat_national_uwwtpT .'</div>'
                      .'</div>'
                        						.'</div>'
                  .'</div>'
                  .'</div>'
                .'<div class="cell charts-rows-cell">'
                  .'<div class="cell-content">'
                    .'<div class="container flip">'

                      .'<div class="rightgraph front">'
                            . '<div class="flot-title"><div class="flip-title">Load entering by treatment type : total agglomerations</div>


                            <img src="'.file_create_url(drupal_get_path('theme', 'uwwtd').'/images/corner-table-off.png').'" class="button-flipper to-table" title="See the data table" alt="See the data table">
                            </div>'
                            		. '<div class="view-content"><svg id="graph_loadenteringByTreatmenttypeAgglomeration" style="margin:10px;"/></div>'
                      .'</div>'

                      .'<div class="rightgraph back">'
                        . '<div class="flot-title flip-title-back"><div class="flip-title">Load entering by treatment type : total agglomerations</div>


                        <img src="'.file_create_url(drupal_get_path('theme', 'uwwtd').'/images/corner-chart-off.png').'" class="button-flipper to-chart" title="See diagram" alt="See diagram">
                        		</div>'
                        				. '<div class="view-content">'. $aString_uwwtd_stat_agglomeration_uwwtpT .'</div>'
                      				.'</div>'
                      				.'</div>'
                  .'</div>'
                      						.'</div>'
            .'</div>'
            ;

     //Total generated load by agglomeration
     //
     $formResult .= '<div class="rows charts-row" >'
     		.'<div class="cell charts-rows-cell">'
                  .'<div class="cell-content">'
                    .'<div class="container flip" style=" height: 400px; ">'
                      .'<div class="leftgraph front">'
                      . '<div class="flot-title"><div class="flip-title">Total generated load by agglomeration</div>


                        <img src="'.file_create_url(drupal_get_path('theme', 'uwwtd').'/images/corner-table-off.png').'" class="button-flipper to-table" title="See the data table" alt="See the data table">
                        		</div>'
                        		. '<div class="view-content"><svg id="graph_generatedByAgglomeration" style="margin:10px;"/></div>'
                      .'</div>'

                             		.'<div class="leftgraph back">'
                             		. '<div class="flot-title flip-title-back"><div class="flip-title">Total generated load by agglomeration</div>


                        <img src="'.file_create_url(drupal_get_path('theme', 'uwwtd').'/images/corner-chart-off.png').'" class="button-flipper to-chart" title="See diagram" alt="See diagram">
                        		</div>'
                        				. '<div class="view-content">'. $aString_uwwtd_stat_national_generated_by_agglomeration .'</div>'
                      .'</div>'
                        						.'</div>'
                  .'</div>'
                .'</div>'
                .'<div class="cell charts-rows-cell">'
                  .'<div class="cell-content">'
                    .'<div class="container flip" style=" height: 400px; ">'

                    .'<div class="rightgraph front">'
                    		. '<div class="flot-title"><div class="flip-title">???</div>


                            <img src="'.file_create_url(drupal_get_path('theme', 'uwwtd').'/images/corner-table-off.png').'" class="button-flipper to-table" title="See the data table" alt="See the data table">
                            </div>'
                            		. '<div class="view-content"><svg id="123456" style="margin:10px;"/></div>'
                      .'</div>'

                      .'<div class="rightgraph back">'
                        . '<div class="flot-title flip-title-back"><div class="flip-title">???</div>


                        <img src="'.file_create_url(drupal_get_path('theme', 'uwwtd').'/images/corner-chart-off.png').'" class="button-flipper to-chart" title="See diagram" alt="See diagram">
                        		</div>'
                        				. '<div class="view-content">Lorem ipsum dolor</div>'
                        				.'</div>'
                    .'</div>'
                        						.'</div>'
                .'</div>'
                        								.'</div>'
     ;

	//Total load entering and discharged
	//BOD, COD, N, P concentration
     $formResult .= '<div class="rows charts-row" >'
                .'<div class="cell charts-rows-cell">'
                  .'<div class="cell-content">'
                    .'<div class="container flip" style=" height: 400px; ">'
                    .'<div class="leftgraph front">'
                    . '<div class="flot-title"><div class="flip-title">Total load entering and discharged</div>


                        <img src="'.file_create_url(drupal_get_path('theme', 'uwwtd').'/images/corner-table-off.png').'" class="button-flipper to-table" title="See the data table" alt="See the data table">
                        </div>'
                        		. '<div class="view-content"><svg id="graph_load_ent_and_dis" style="margin:10px;"/></div>'
                      .'</div>'

                      .'<div class="leftgraph back">'
                        . '<div class="flot-title flip-title-back"><div class="flip-title">Total load entering and discharged</div>


                        		<img src="'.file_create_url(drupal_get_path('theme', 'uwwtd').'/images/corner-chart-off.png').'" class="button-flipper to-chart" title="See diagram" alt="See diagram">
                        				</div>'
                        . '<div class="view-content">'. $aString_uwwtd_load_ent_and_dis .'</div>'
                        		.'</div>'
                    .'</div>'
                        		.'</div>'
                .'</div>'
                        				.'<div class="cell charts-rows-cell">'
                  .'<div class="cell-content">'
                    .'<div class="container flip" style=" height: 400px; ">'

                      .'<div class="rightgraph front">'
                            . '<div class="flot-title"><div class="flip-title">BOD, COD, N, P concentration</div>


                      		<img src="'.file_create_url(drupal_get_path('theme', 'uwwtd').'/images/corner-table-off.png').'" class="button-flipper to-table" title="See the data table" alt="See the data table">
                      				</div>'
                            . '<div class="view-content"><svg id="graph_per_ent_and_dis" style="margin:10px;"/></div>'
                      						.'</div>'

                      						.'<div class="rightgraph back">'
                        . '<div class="flot-title flip-title-back"><div class="flip-title">BOD, COD, N, P concentration</div>


                        		<img src="'.file_create_url(drupal_get_path('theme', 'uwwtd').'/images/corner-chart-off.png').'" class="button-flipper to-chart" title="See diagram" alt="See diagram">
                        				</div>'
                        				. '<div class="view-content">' . $aString_uwwtd_per_ent_and_dis . '</div>'
                        				.'</div>'
                        				.'</div>'
                        				.'</div>'
                        				.'</div>'
                        				.'</div>'
                        				;

    $formResult .= "
    <script>
    jQuery(document).ready(function(){
        display_piechart_custom(".json_encode($Data_uwwtd_stat_national_compliance).",'graph_generatedByCompliance','end');
        display_piechart_custom(".json_encode($Data_uwwtd_stat_agglomeration_compliance).",'graph_agglomerationByCompliance','end');
        display_piechart_custom(".json_encode($aData_uwwtd_stat_national_uwwtpC).",'graph_loadenteringByCompliance','middle');
        display_piechart_custom(".json_encode($aData_uwwtd_stat_agglomeration_uwwtpC).",'graph_loadenteringByComplianceAgglomeration','middle');
        display_piechart_custom(".json_encode($aData_uwwtd_stat_national_uwwtpT).",'graph_loadenteringByTreatmenttype','middle');
		display_piechart_custom(".json_encode($aData_uwwtd_stat_agglomeration_uwwtpT).",'graph_loadenteringByTreatmenttypeAgglomeration','middle');

        stackedbar_nat_gen_load(".json_encode($aData_uwwtd_stat_national_generated_by_agglomeration).");
        stackedbar_load_ent_and_dis(".json_encode($aData_uwwtd_load_ent_and_dis).','. json_encode($aColor_uwwtd_load_ent_and_dis).",'graph_load_ent_and_dis');
		stackedbar_load_ent_and_dis(".json_encode($aData_uwwtd_per_ent_and_dis).','. json_encode($aColor_uwwtd_per_ent_and_dis).",'graph_per_ent_and_dis');

    });
    </script>
    ";


	return  $formResult;

}


?>